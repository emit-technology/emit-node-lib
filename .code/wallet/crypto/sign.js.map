{"version":3,"file":"sign.js","sourceRoot":"","sources":["../../../src/wallet/crypto/sign.ts"],"names":[],"mappings":"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","sourcesContent":["import {SignEL} from \"../types/crypto\";\nimport {blake2bHash, signPrepareBlock, toScalar} from \"../sign\";\nimport {fromAddressBytes, getPublicKeyBs58} from \"../address\";\nimport {ED_BASE} from \"../serial\";\nimport * as ed from \"@noble/ed25519\";\nimport {toBuffer} from \"../utils\";\n\nconst BN = require('bn.js');\n\nexport const ecsign = (m:string, privateKey: Buffer):SignEL =>{\n   const sign = signPrepareBlock(m,privateKey)\n   return {\n      r: sign.r,\n      s: sign.s,\n      v: getPublicKeyBs58(privateKey)\n   }\n}\n\nexport const ecrecover = (signEL:SignEL,h:string):string => {\n   const s = toScalar(Buffer.from(signEL.s,\"hex\"));\n   const R = ed.RistrettoPoint.fromHex(signEL.r);\n   const sig:Signature = {\n      s:s,\n      R:R\n   }\n   const pb = fromAddressBytes(signEL.v);\n   const m = Buffer.from(h, \"hex\");\n   if(verify(m,sig,pb)){\n      return signEL.v\n   }\n   return \"Invalid sig\"\n}\n\nexport interface Signature{\n   s: bigint;\n   R: ed.RistrettoPoint;\n}\n\nexport const verify = (m:Buffer,sig:Signature,publicKey:Buffer)=>{\n   const left = ED_BASE.multiply(sig.s);\n   const pkHex = new BN(publicKey).toString(\"hex\");\n   const concatBuf = Buffer.concat([m, sig.R.toRawBytes()]);\n   let hash = blake2bHash(\"EMIT-SIGN\", concatBuf);\n   const e = toScalar(hash.slice(0, 32));\n   const right = ed.RistrettoPoint.fromHex(pkHex).multiply(e).add(sig.R)  ;//;new BN(mod(mod(toScalar() * e) + sig.R)).toArrayLike(Buffer, \"le\");\n   return  left.equals(right);\n}\n\n\nexport const personalSign = (privateKey: Buffer, msgParams:string):string =>{\n   ecsign(``)\n}\n\nexport const recoverPersonalSignature = (sig:SignEL): string =>{\n\n}\n\nexport const hashPersonalMessage = function (message:Buffer) {\n   const prefix = toBuffer('\\x19Ethereum Signed Message:\\n' + message.length.toString());\n   return exports.keccak(Buffer.concat([prefix, message]));\n};"]}